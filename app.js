(()=>{"use strict";var t=function(){function t(t){this.m_mmu=t,this.m_registers=[8].fill(0),this.m_instructionMethods1=[this.LD_R_to_R,this.LD_8_Bit],this.P1=65280,this.DIV=65283,this.TIMA=65285,this.TMA=65286,this.TAC=65287,this.IF=65295,this.IE=65535,this.m_jstate1=0,this.m_jstate2=0,this.m_BIOSMapped=!0,this.m_PC=0,this.m_SP=0,this.m_clock=0,this.IME=!1,this.m_cbPrefix=!1,this.m_isHalted=!1,this.m_falligEdgeDelay=!1}return t.prototype.step=function(){16&this.m_mmu.read(this.P1)?this.m_mmu.write(this.P1,this.P1|this.m_jstate2):this.m_mmu.write(this.P1,this.P1|this.m_jstate1),0==this.m_clock?(this.getInput(),this.m_clock=1e3):this.m_clock-=1,this.updateTimer(),this.checkForInterupts(),this.m_isHalted||(console.log(this.m_clock),console.log(this.m_mmu),console.log(this.m_mmu.read(this.m_PC)),0==this.m_clock&&this.execute(this.m_mmu.read(this.m_PC)),this.m_clock-=1)},t.prototype.getInput=function(){},t.prototype.execute=function(t){256==this.m_PC&&(this.m_BIOSMapped=!1);var s=(192&t)>>6,i=(56&t)>>3,e=7&t;this.m_instructionMethods1[t](s,i,e),this.m_PC+=1,this.IME,this.m_SP,this.m_cbPrefix,this.m_falligEdgeDelay},t.prototype.updateTimer=function(){},t.prototype.checkForInterupts=function(){},t.prototype.LD_R_to_R=function(t,s,i){6==i?(this.m_registers[s]=this.m_mmu.read(this.getHL()),this.m_clock=8):6==s?(this.m_mmu.write(this.getHL(),this.m_registers[i]),this.m_clock=8):(this.m_registers[s]=this.m_registers[i],this.m_clock=4)},t.prototype.LD_8_Bit=function(t,s,i){if(3==t){var e=0;if(0==i)switch(s){case 4:65280==(e=65280+this.m_mmu.read(++this.m_PC))?this.m_mmu.write(e,48&this.m_registers[7]):this.m_mmu.write(e,this.m_registers[7]),this.m_clock=12;break;case 6:e=65280+this.m_mmu.read(++this.m_PC),this.m_registers[7]=this.m_mmu.read(e),this.m_clock=12}else if(2==i)switch(s){case 4:e=65280+this.m_registers[1],this.m_mmu.write(e,this.m_registers[7]),this.m_clock=8;break;case 5:e=this.m_mmu.read(++this.m_PC)+(this.m_mmu.read(++this.m_PC)<<8),this.m_mmu.write(e,this.m_registers[7]),this.m_clock=16;break;case 6:e=65280+this.m_registers[1],this.m_registers[7]=this.m_mmu.read(e),this.m_clock=8;break;case 7:e=this.m_mmu.read(++this.m_PC)+(this.m_mmu.read(++this.m_PC)<<8),this.m_registers[7]=this.m_mmu.read(e),this.m_clock=16}}else if(2==i){var m=this.getHL();switch(s){case 0:this.m_mmu.write(this.getBC(),this.m_registers[7]),this.m_clock=8;break;case 1:this.m_registers[7]=this.m_mmu.read(this.getBC()),this.m_clock=8;break;case 2:this.m_mmu.write(this.getDE(),this.m_registers[7]),this.m_clock=8;break;case 3:this.m_registers[7]=this.m_mmu.read(this.getDE()),this.m_clock=8;break;case 4:case 6:this.m_mmu.write(m,this.m_registers[7]),this.m_clock=8;break;case 5:case 7:this.m_registers[7]=this.m_mmu.read(m),this.m_clock=8}}else if(6==i){var h=this.m_mmu.read(++this.m_PC);6==s?(this.m_mmu.write(this.getHL(),h),this.m_clock=12):(this.m_registers[s]=h,this.m_clock=8)}},t.prototype.getAF=function(){return this.m_registers[7]<<8+this.m_registers[6]},t.prototype.getBC=function(){return this.m_registers[0]<<8+this.m_registers[1]},t.prototype.getDE=function(){return this.m_registers[2]<<8+this.m_registers[3]},t.prototype.getHL=function(){return this.m_registers[4]<<8+this.m_registers[5]},t}(),s=function(){function t(t,s){this.m_mmu=t,this.m_frame=s,this.m_mmu,this.m_frame}return t.prototype.step=function(){},t}(),i=function(){function t(){this.m_addrBus=Array(65535).fill(0)}return t.prototype.read=function(t){return this.m_addrBus[65535&t]},t.prototype.write=function(t,s){this.m_addrBus[65535&t]=255&s},t}(),e=function(){function e(e){this.m_path=e,this.m_frame=[23040].fill(0),this.m_mmu=new i,this.m_cpu=new t(this.m_mmu),this.m_gpu=new s(this.m_mmu,this.m_frame),this.m_inVBLANK=!1,this.m_cpu,this.m_gpu,this.m_inVBLANK}return e.prototype.getFrame=function(){for(var t=0;t<100;t++)this.m_cpu.step(),this.m_gpu.step();return this.m_frame},e}(),m=document.getElementById("canvas").getContext("2d"),h=m.createImageData(160,144),r=0,_=new e("TBD");function c(){_.getFrame()}setInterval((function(){var t=h.data;t[4*r]=255,t[4*r+3]=255,m.putImageData(h,0,0),r+=1}),1e3/60),c(),c(),c()})();