(()=>{"use strict";var t=function(){function t(t){this.m_mmu=t,this.m_registers=[8].fill(0),this.m_instructionMethods1=[this.opcode00,this.opcode00,this.LD_8_Bit,this.JR,this.INC,this.DEC,this.JP,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.INC,this.DEC,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.INC,this.DEC,this.opcode00,this.opcode00,this.JR,this.opcode00,this.opcode00,this.opcode00,this.INC,this.DEC,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.INC,this.DEC,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.INC,this.DEC,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.INC,this.DEC,this.opcode00,this.opcode00,this.JR,this.opcode00,this.opcode00,this.opcode00,this.INC,this.DEC,this.opcode00,this.opcode00,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.ADD,this.ADD,this.ADD,this.ADD,this.ADD,this.ADD,this.ADD,this.ADD,this.ADD,this.ADD,this.ADD,this.ADD,this.ADD,this.ADD,this.ADD,this.ADD,this.SUB,this.SUB,this.SUB,this.SUB,this.SUB,this.SUB,this.SUB,this.SUB,this.SUB,this.SUB,this.SUB,this.SUB,this.SUB,this.SUB,this.SUB,this.SUB,this.AND,this.AND,this.AND,this.AND,this.AND,this.AND,this.AND,this.AND,this.XOR,this.XOR,this.XOR,this.XOR,this.XOR,this.XOR,this.XOR,this.XOR,this.OR,this.OR,this.OR,this.OR,this.OR,this.OR,this.OR,this.OR,this.CP,this.CP,this.CP,this.CP,this.CP,this.CP,this.CP,this.CP,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00,this.opcode00],this.P1=65280,this.DIV=65283,this.TIMA=65285,this.TMA=65286,this.TAC=65287,this.IF=65295,this.IE=65535,this.R={A:7,B:0,C:1,D:2,E:3,F:6,H:4,L:5},this.m_jstate1=0,this.m_jstate2=0,this.m_BIOSMapped=!0,this.m_PC=0,this.m_SP=0,this.m_clock=0,this.IME=!1,this.m_cbPrefix=!1,this.m_isHalted=!1,this.m_falligEdgeDelay=!1,this.DIV,this.TIMA,this.TMA,this.TAC,this.IF,this.IE}return t.prototype.step=function(){16&this.m_mmu.read(this.P1)?this.m_mmu.write(this.P1,this.P1|this.m_jstate2):this.m_mmu.write(this.P1,this.P1|this.m_jstate1),0==this.m_clock?(this.getInput(),this.m_clock=1e3):this.m_clock-=1,this.updateTimer(),this.checkForInterupts(),this.m_isHalted||(console.log(this.m_clock),console.log(this.m_mmu),console.log(this.m_mmu.read(this.m_PC)),0==this.m_clock&&this.execute(this.m_mmu.read(this.m_PC)),this.m_clock-=1)},t.prototype.getInput=function(){},t.prototype.execute=function(t){256==this.m_PC&&(this.m_BIOSMapped=!1);var s=(192&t)>>6,i=(56&t)>>3,h=7&t;this.m_instructionMethods1[t](s,i,h),this.m_PC+=1,this.IME,this.m_SP,this.m_cbPrefix,this.m_falligEdgeDelay},t.prototype.updateTimer=function(){},t.prototype.checkForInterupts=function(){},t.prototype.LD_R_to_R=function(t,s,i){6==i?(this.m_registers[s]=this.m_mmu.read(this.getHL()),this.m_clock=8):6==s?(this.m_mmu.write(this.getHL(),this.m_registers[i]),this.m_clock=8):(this.m_registers[s]=this.m_registers[i],this.m_clock=4)},t.prototype.LD_8_Bit=function(t,s,i){if(3==t){var h=0;if(0==i)switch(s){case 4:65280==(h=65280+this.m_mmu.read(++this.m_PC))?this.m_mmu.write(h,48&this.m_registers[7]):this.m_mmu.write(h,this.m_registers[7]),this.m_clock=12;break;case 6:h=65280+this.m_mmu.read(++this.m_PC),this.m_registers[7]=this.m_mmu.read(h),this.m_clock=12}else if(2==i)switch(s){case 4:h=65280+this.m_registers[1],this.m_mmu.write(h,this.m_registers[7]),this.m_clock=8;break;case 5:h=this.m_mmu.read(++this.m_PC)+(this.m_mmu.read(++this.m_PC)<<8),this.m_mmu.write(h,this.m_registers[7]),this.m_clock=16;break;case 6:h=65280+this.m_registers[1],this.m_registers[7]=this.m_mmu.read(h),this.m_clock=8;break;case 7:h=this.m_mmu.read(++this.m_PC)+(this.m_mmu.read(++this.m_PC)<<8),this.m_registers[7]=this.m_mmu.read(h),this.m_clock=16}}else if(2==i){var e=this.getHL();switch(s){case 0:this.m_mmu.write(this.getBC(),this.m_registers[7]),this.m_clock=8;break;case 1:this.m_registers[7]=this.m_mmu.read(this.getBC()),this.m_clock=8;break;case 2:this.m_mmu.write(this.getDE(),this.m_registers[7]),this.m_clock=8;break;case 3:this.m_registers[7]=this.m_mmu.read(this.getDE()),this.m_clock=8;break;case 4:case 6:this.m_mmu.write(e,this.m_registers[7]),this.m_clock=8;break;case 5:case 7:this.m_registers[7]=this.m_mmu.read(e),this.m_clock=8}}else if(6==i){var o=this.m_mmu.read(++this.m_PC);6==s?(this.m_mmu.write(this.getHL(),o),this.m_clock=12):(this.m_registers[s]=o,this.m_clock=8)}},t.prototype.JP=function(){var t=this.m_mmu.read(this.m_PC),s=56&t,i=7&t;if(1==i)this.m_PC=this.getHL()-1,this.m_clock=4;else{var h=this.m_mmu.read(++this.m_PC),e=(this.m_mmu.read(++this.m_PC)<<8)+h;if(this.m_clock=12,2==i)switch(s){case 0:if(this.getZ())return;break;case 1:if(!this.getZ())return;break;case 2:if(this.getC())return;break;case 3:if(!this.getC())return}this.m_PC=e-1,this.m_clock=16}},t.prototype.JR=function(){var t=this.m_mmu.read(++this.m_PC),s=56&this.m_mmu.read(this.m_PC);if(3!=s)switch(this.m_clock=8,s){case 4:if(this.getZ())return;break;case 5:if(!this.getZ())return;break;case 6:if(this.getC())return;break;case 7:if(!this.getC())return}this.m_PC+=t,this.m_clock=12},t.prototype.ADD=function(){var t=this.m_registers[this.R.A],s=0,i=0,h=this.m_mmu.read(this.m_PC),e=192&h,o=7&h;1==(56&h)&&(i=Number(this.getC())),3==e?(s=this.m_mmu.read(++this.m_PC),this.m_clock=8):6==o?(s=this.m_mmu.read(this.getHL()),this.m_clock=8):(s=this.m_registers[o],this.m_clock=4),this.m_registers[this.R.A]=t+s+i&255,this.setZ(0==this.m_registers[this.R.A]),this.setN(!1),this.setH((15&t)+(15&s)+i>15),this.setC(t+s+i>255)},t.prototype.SUB=function(){var t=this.m_registers[this.R.A],s=0,i=0,h=this.m_mmu.read(this.m_PC),e=192&h,o=7&h;3==(56&h)&&(i=Number(this.getC())),3==e?(s=this.m_mmu.read(++this.m_PC),this.m_clock=8):6==o?(s=this.m_mmu.read(this.getHL()),this.m_clock=8):(s=this.m_registers[o],this.m_clock=4),this.setH((15&t)<(15&s)+i),this.m_registers[this.R.A]=t-s-i&255,this.setC(s+i>t),this.setZ(0==this.m_registers[this.R.A]),this.setN(!0)},t.prototype.AND=function(){var t=this.m_mmu.read(this.m_PC),s=7&t;3==(192&t)?(this.m_registers[this.R.A]&=this.m_mmu.read(++this.m_PC),this.m_clock=8):6==s?(this.m_registers[this.R.A]&=this.m_mmu.read(this.getHL()),this.m_clock=8):(this.m_registers[this.R.A]&=this.m_registers[s],this.m_clock=4),this.setZ(0==this.m_registers[this.R.A]),this.setC(!1),this.setH(!0),this.setN(!1)},t.prototype.XOR=function(){var t=this.m_mmu.read(this.m_PC),s=7&t;3==(192&t)?(this.m_registers[this.R.A]^=this.m_mmu.read(++this.m_PC),this.m_clock=8):6==s?(this.m_registers[this.R.A]^=this.m_mmu.read(this.getHL()),this.m_clock=8):(this.m_registers[this.R.A]^=this.m_registers[s],this.m_clock=4),this.setZ(0==this.m_registers[this.R.A]),this.setC(!1),this.setH(!1),this.setN(!1)},t.prototype.OR=function(){var t=this.m_mmu.read(this.m_PC),s=7&t;3==(192&t)?(this.m_registers[this.R.A]|=this.m_mmu.read(++this.m_PC),this.m_clock=8):6==s?(this.m_registers[this.R.A]|=this.m_mmu.read(this.getHL()),this.m_clock=8):(this.m_registers[this.R.A]|=this.m_registers[s],this.m_clock=4),this.setZ(0==this.m_registers[this.R.A]),this.setC(!1),this.setH(!1),this.setN(!1)},t.prototype.CP=function(){var t=this.m_registers[this.R.A],s=0,i=this.m_mmu.read(this.m_PC),h=7&i;3==(192&i)?(s=this.m_mmu.read(++this.m_PC),this.m_clock=8):6==h?(s=this.m_mmu.read(this.getHL()),this.m_clock=8):(s=this.m_registers[h],this.m_clock=4),this.setH((t-s&15)>(15&t)),this.setC(s>t),this.setZ(s==t),this.setN(!0)},t.prototype.INC=function(){var t=0,s=56&this.m_mmu.read(this.m_PC);6==s?(this.m_mmu.write(this.getHL(),this.m_mmu.read(this.getHL())+1),t=this.m_mmu.read(this.getHL()),this.m_clock=12):(this.m_registers[s]=this.m_registers[s]+1&255,t=this.m_registers[s],this.m_clock=4),this.setZ(0==t),this.setH(0==(15&t)),this.setN(!1)},t.prototype.DEC=function(){var t=0,s=56&this.m_mmu.read(this.m_PC);6==s?(this.m_mmu.write(this.getHL(),this.m_mmu.read(this.getHL())-1),t=this.m_mmu.read(this.getHL()),this.m_clock=12):(this.m_registers[s]=this.m_registers[s]-1&255,t=this.m_registers[s],this.m_clock=4),this.setZ(0==t),this.setH(15==(15&t)),this.setN(!0)},t.prototype.opcode00=function(){this.m_clock=4},t.prototype.getBC=function(){return this.m_registers[this.R.B]<<8+this.m_registers[this.R.C]},t.prototype.getDE=function(){return this.m_registers[this.R.D]<<8+this.m_registers[this.R.E]},t.prototype.getHL=function(){return this.m_registers[this.R.E]<<8+this.m_registers[this.R.L]},t.prototype.getC=function(){return(16&this.m_registers[this.R.F])>0},t.prototype.getZ=function(){return(128&this.m_registers[this.R.F])>0},t.prototype.setC=function(t){t?this.m_registers[this.R.F]|=16:this.m_registers[this.R.F]&=239},t.prototype.setH=function(t){t?this.m_registers[this.R.F]|=32:this.m_registers[this.R.F]&=223},t.prototype.setN=function(t){t?this.m_registers[this.R.F]|=64:this.m_registers[this.R.F]&=191},t.prototype.setZ=function(t){t?this.m_registers[this.R.F]|=128:this.m_registers[this.R.F]&=127},t}(),s=function(){function t(t,s){this.m_mmu=t,this.m_frame=s,this.m_mmu,this.m_frame}return t.prototype.step=function(){},t}(),i=function(){function t(){this.m_addrBus=Array(65535).fill(0)}return t.prototype.read=function(t){return this.m_addrBus[65535&t]},t.prototype.write=function(t,s){this.m_addrBus[65535&t]=255&s},t}(),h=function(){function h(h){this.m_path=h,this.m_frame=[23040].fill(0),this.m_mmu=new i,this.m_cpu=new t(this.m_mmu),this.m_gpu=new s(this.m_mmu,this.m_frame),this.m_inVBLANK=!1,this.m_cpu,this.m_gpu,this.m_inVBLANK}return h.prototype.getFrame=function(){for(var t=0;t<100;t++)this.m_cpu.step(),this.m_gpu.step();return this.m_frame},h}(),e=document.getElementById("canvas").getContext("2d"),o=e.createImageData(160,144),_=0,m=new h("TBD");function r(){m.getFrame()}setInterval((function(){var t=o.data;t[4*_]=255,t[4*_+3]=255,e.putImageData(o,0,0),_+=1}),1e3/60),r(),r(),r()})();