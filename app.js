(()=>{"use strict";var t=function(){function t(t){this.m_mmu=t,this.m_instructionMethods1=[this.opcode00,this.opcode01,this.opcode02,this.INC_16_BIT,this.INC,this.DEC,this.LD_8_Bit,this.RLC,this.LD_16_Bit,this.ADD_16_BIT,this.LD_8_Bit,this.DEC_16_BIT,this.INC,this.DEC,this.LD_8_Bit,this.RRC,this.STOP,this.LD_16_Bit,this.LD_8_Bit,this.INC_16_BIT,this.INC,this.DEC,this.LD_8_Bit,this.RL,this.JR,this.ADD_16_BIT,this.LD_8_Bit,this.DEC_16_BIT,this.INC,this.DEC,this.LD_8_Bit,this.RR,this.JR,this.LD_16_Bit,this.LD_8_Bit,this.INC_16_BIT,this.INC,this.DEC,this.LD_8_Bit,this.DAA,this.JR,this.ADD_16_BIT,this.LD_8_Bit,this.DEC_16_BIT,this.INC,this.DEC,this.LD_8_Bit,this.CPL,this.JR,this.LD_16_Bit,this.LD_8_Bit,this.INC_16_BIT,this.INC,this.DEC,this.LD_8_Bit,this.SCF,this.JR,this.ADD_16_BIT,this.LD_8_Bit,this.DEC_16_BIT,this.INC,this.DEC,this.LD_8_Bit,this.CCF,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.HALT,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.LD_R_to_R,this.ADD,this.ADD,this.ADD,this.ADD,this.ADD,this.ADD,this.ADD,this.ADD,this.ADD,this.ADD,this.ADD,this.ADD,this.ADD,this.ADD,this.ADD,this.ADD,this.SUB,this.SUB,this.SUB,this.SUB,this.SUB,this.SUB,this.SUB,this.SUB,this.SUB,this.SUB,this.SUB,this.SUB,this.SUB,this.SUB,this.SUB,this.SUB,this.AND,this.AND,this.AND,this.AND,this.AND,this.AND,this.AND,this.AND,this.XOR,this.XOR,this.XOR,this.XOR,this.XOR,this.XOR,this.XOR,this.XOR,this.OR,this.OR,this.OR,this.OR,this.OR,this.OR,this.OR,this.OR,this.CP,this.CP,this.CP,this.CP,this.CP,this.CP,this.CP,this.CP,this.RET,this.LD_16_Bit,this.JP,this.JP,this.CALL,this.LD_16_Bit,this.ADD,this.RST,this.RET,this.RET,this.JP,this.CBPrefix,this.CALL,this.CALL,this.ADD,this.RST,this.RET,this.LD_16_Bit,this.JP,this.opcode00,this.CALL,this.LD_16_Bit,this.SUB,this.RST,this.RET,this.RET,this.JP,this.opcode00,this.CALL,this.opcode00,this.SUB,this.RST,this.LD_8_Bit,this.LD_16_Bit,this.LD_8_Bit,this.opcode00,this.opcode00,this.LD_16_Bit,this.AND,this.RST,this.ADD_16_BIT,this.JP,this.LD_8_Bit,this.opcode00,this.opcode00,this.opcode00,this.XOR,this.RST,this.LD_8_Bit,this.LD_16_Bit,this.LD_8_Bit,this.DI,this.opcode00,this.LD_16_Bit,this.OR,this.RST,this.LD_16_Bit,this.LD_16_Bit,this.LD_8_Bit,this.EI,this.opcode00,this.opcode00,this.CP,this.RST],this.m_instructionMethods2=[this.RLC,this.RLC,this.RLC,this.RLC,this.RLC,this.RLC,this.RLC,this.RLC,this.RRC,this.RRC,this.RRC,this.RRC,this.RRC,this.RRC,this.RRC,this.RRC,this.RL,this.RL,this.RL,this.RL,this.RL,this.RL,this.RL,this.RL,this.RR,this.RR,this.RR,this.RR,this.RR,this.RR,this.RR,this.RR,this.SLA,this.SLA,this.SLA,this.SLA,this.SLA,this.SLA,this.SLA,this.SLA,this.SRA,this.SRA,this.SRA,this.SRA,this.SRA,this.SRA,this.SRA,this.SRA,this.SWAP,this.SWAP,this.SWAP,this.SWAP,this.SWAP,this.SWAP,this.SWAP,this.SWAP,this.SRL,this.SRL,this.SRL,this.SRL,this.SRL,this.SRL,this.SRL,this.SRL,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET],this.P1=65280,this.DIV=65283,this.TIMA=65285,this.TMA=65286,this.TAC=65287,this.IF=65295,this.IE=65535,this.R={A:7,B:0,C:1,D:2,E:3,F:6,H:4,L:5},this.m_jstate1=0,this.m_jstate2=0,this.m_BIOSMapped=!0,this.m_PC=0,this.m_SP=0,this.m_clock=0,this.m_registers=new Array(8).fill(0),this.IME=!1,this.m_cbPrefix=!1,this.m_isHalted=!1,this.m_fallingEdgeDelay=!1,this.DIV,this.TIMA,this.TMA,this.TAC,this.IF,this.IE}return t.prototype.step=function(){16&this.m_mmu.read(this.P1)?this.m_mmu.write(this.P1,this.P1|this.m_jstate2):this.m_mmu.write(this.P1,this.P1|this.m_jstate1),0==this.m_clock?(this.getInput(),this.m_clock=1e3):this.m_clock-=1,this.updateTimer(),this.checkForInterupts(),this.m_isHalted||(this.execute(this.m_mmu.read(this.m_PC)),this.m_clock-=1)},t.prototype.getInput=function(){},t.prototype.execute=function(t){console.log(this.m_PC),console.log(t),console.log(this.m_registers),256==this.m_PC&&(this.m_BIOSMapped=!1),this.m_instructionMethods1[t].call(this),this.m_PC+=1,this.IME,this.m_SP,this.m_cbPrefix},t.prototype.updateTimer=function(){if(this.m_mmu.write(this.DIV,this.m_mmu.read(this.DIV)+1),(4&this.m_mmu.read(this.TAC))>0){var t=this.m_mmu.read(this.TIMA);(3&this.m_mmu.read(this.TAC))>0?(this.m_mmu.read(this.DIV)&2<<2*(3&this.m_mmu.read(this.TAC)))>0?this.m_fallingEdgeDelay=!0:this.m_fallingEdgeDelay&&(t+=1,this.m_fallingEdgeDelay=!1):(512&this.m_mmu.read(this.DIV))>0?this.m_fallingEdgeDelay=!0:this.m_fallingEdgeDelay&&(t+=1,this.m_fallingEdgeDelay=!1),t>255?(this.m_mmu.write(this.TIMA,this.m_mmu.read(this.TMA)),this.m_mmu.write(this.IF,4|this.m_mmu.read(this.IF))):this.m_mmu.write(this.TIMA,255&t)}},t.prototype.checkForInterupts=function(){},t.prototype.LD_R_to_R=function(){var t=this.m_mmu.read(this.m_PC),s=(56&t)>>3,i=7&t;6==i?(this.m_registers[s]=this.m_mmu.read(this.getHL()),this.m_clock=8):6==s?(this.m_mmu.write(this.getHL(),this.m_registers[i]),this.m_clock=8):(this.m_registers[s]=this.m_registers[i],this.m_clock=4)},t.prototype.LD_8_Bit=function(){var t=this.m_mmu.read(this.m_PC),s=(56&t)>>3,i=7&t;if(3==(192&t)>>6){var h=0;if(0==i)switch(s){case 4:65280==(h=65280+this.m_mmu.read(++this.m_PC))?this.m_mmu.write(h,48&this.m_registers[7]):this.m_mmu.write(h,this.m_registers[7]),this.m_clock=12;break;case 6:h=65280+this.m_mmu.read(++this.m_PC),this.m_registers[7]=this.m_mmu.read(h),this.m_clock=12}else if(2==i)switch(s){case 4:h=65280+this.m_registers[1],this.m_mmu.write(h,this.m_registers[7]),this.m_clock=8;break;case 5:h=this.m_mmu.read(++this.m_PC)+(this.m_mmu.read(++this.m_PC)<<8),this.m_mmu.write(h,this.m_registers[7]),this.m_clock=16;break;case 6:h=65280+this.m_registers[1],this.m_registers[7]=this.m_mmu.read(h),this.m_clock=8;break;case 7:h=this.m_mmu.read(++this.m_PC)+(this.m_mmu.read(++this.m_PC)<<8),this.m_registers[7]=this.m_mmu.read(h),this.m_clock=16}}else if(2==i){var m=this.getHL();switch(s){case 0:this.m_mmu.write(this.getBC(),this.m_registers[7]),this.m_clock=8;break;case 1:this.m_registers[7]=this.m_mmu.read(this.getBC()),this.m_clock=8;break;case 2:this.m_mmu.write(this.getDE(),this.m_registers[7]),this.m_clock=8;break;case 3:this.m_registers[7]=this.m_mmu.read(this.getDE()),this.m_clock=8;break;case 4:case 6:this.m_mmu.write(m,this.m_registers[7]),this.m_clock=8;break;case 5:case 7:this.m_registers[7]=this.m_mmu.read(m),this.m_clock=8}}else if(6==i){var e=this.m_mmu.read(++this.m_PC);6==s?(this.m_mmu.write(this.getHL(),e),this.m_clock=12):(this.m_registers[s]=e,this.m_clock=8)}},t.prototype.LD_16_Bit=function(){var t=this.m_mmu.read(this.m_PC),s=56&t;if(3==(192&t))if(1==(7&t)){var i=0,h=0;switch(s){case 0:i=this.m_mmu.read(this.m_SP++),h=this.m_mmu.read(this.m_SP++),this.setBC((h<<8)+i),this.m_clock=12;break;case 2:i=this.m_mmu.read(this.m_SP++),h=this.m_mmu.read(this.m_SP++),this.setDE((h<<8)+i),this.m_clock=12;break;case 4:i=this.m_mmu.read(this.m_SP++),h=this.m_mmu.read(this.m_SP++),this.setHL((h<<8)+i),this.m_clock=12;break;case 6:i=this.m_mmu.read(this.m_SP++),h=this.m_mmu.read(this.m_SP++),this.setAF((h<<8)+i),this.m_clock=12;break;case 7:this.m_SP=this.getHL(),this.m_clock=8}}else{var m=0;switch(s){case 0:this.m_mmu.write(--this.m_PC,this.m_registers[this.R.B]),this.m_mmu.write(--this.m_PC,this.m_registers[this.R.C]),this.m_clock=16;break;case 2:this.m_mmu.write(--this.m_PC,this.m_registers[this.R.D]),this.m_mmu.write(--this.m_PC,this.m_registers[this.R.E]),this.m_clock=16;break;case 4:this.m_mmu.write(--this.m_PC,this.m_registers[this.R.H]),this.m_mmu.write(--this.m_PC,this.m_registers[this.R.L]),this.m_clock=16;break;case 6:this.m_mmu.write(--this.m_PC,this.m_registers[this.R.F]),this.m_mmu.write(--this.m_PC,this.m_registers[this.R.A]),this.m_clock=16;break;case 7:m=this.m_mmu.read(++this.m_PC),this.setHL(this.m_SP+m),this.setZ(!1),this.setN(!1),this.setH(16==(16&(this.m_SP^this.getHL()^m))),this.setC(256==(256&(this.m_SP^this.getHL()^m))),this.m_clock=12}}else{i=this.m_mmu.read(++this.m_PC),h=this.m_mmu.read(++this.m_PC);var e=void 0;switch(s){case 0:this.setBC((h<<8)+i),this.m_clock=12;break;case 1:e=(h<<8)+i,this.m_mmu.write(e,255&this.m_SP),this.m_mmu.write(e+1,65280&this.m_SP),this.m_clock=20;break;case 2:this.setDE((h<<8)+i),this.m_clock=12;break;case 4:this.setHL((h<<8)+i),this.m_clock=12;break;case 6:this.m_PC=(h<<8)+i,this.m_clock=12}}},t.prototype.JP=function(){var t=this.m_mmu.read(this.m_PC),s=56&t,i=7&t;if(1==i)this.m_PC=this.getHL()-1,this.m_clock=4;else{var h=this.m_mmu.read(++this.m_PC),m=(this.m_mmu.read(++this.m_PC)<<8)+h;if(this.m_clock=12,2==i)switch(s){case 0:if(this.getZ())return;break;case 1:if(!this.getZ())return;break;case 2:if(this.getC())return;break;case 3:if(!this.getC())return}this.m_PC=m-1,this.m_clock=16}},t.prototype.JR=function(){var t=this.m_mmu.read(++this.m_PC),s=56&this.m_mmu.read(this.m_PC);if(3!=s)switch(this.m_clock=8,s){case 4:if(this.getZ())return;break;case 5:if(!this.getZ())return;break;case 6:if(this.getC())return;break;case 7:if(!this.getC())return}this.m_PC+=t,this.m_clock=12},t.prototype.ADD=function(){var t=this.m_registers[this.R.A],s=0,i=0,h=this.m_mmu.read(this.m_PC),m=192&h,e=7&h;1==(56&h)&&(i=Number(this.getC())),3==m?(s=this.m_mmu.read(++this.m_PC),this.m_clock=8):6==e?(s=this.m_mmu.read(this.getHL()),this.m_clock=8):(s=this.m_registers[e],this.m_clock=4),this.m_registers[this.R.A]=t+s+i&255,this.setZ(0==this.m_registers[this.R.A]),this.setN(!1),this.setH((15&t)+(15&s)+i>15),this.setC(t+s+i>255)},t.prototype.SUB=function(){var t=this.m_registers[this.R.A],s=0,i=0,h=this.m_mmu.read(this.m_PC),m=192&h,e=7&h;3==(56&h)&&(i=Number(this.getC())),3==m?(s=this.m_mmu.read(++this.m_PC),this.m_clock=8):6==e?(s=this.m_mmu.read(this.getHL()),this.m_clock=8):(s=this.m_registers[e],this.m_clock=4),this.setH((15&t)<(15&s)+i),this.m_registers[this.R.A]=t-s-i&255,this.setC(s+i>t),this.setZ(0==this.m_registers[this.R.A]),this.setN(!0)},t.prototype.AND=function(){var t=this.m_mmu.read(this.m_PC),s=7&t;3==(192&t)?(this.m_registers[this.R.A]&=this.m_mmu.read(++this.m_PC),this.m_clock=8):6==s?(this.m_registers[this.R.A]&=this.m_mmu.read(this.getHL()),this.m_clock=8):(this.m_registers[this.R.A]&=this.m_registers[s],this.m_clock=4),this.setZ(0==this.m_registers[this.R.A]),this.setC(!1),this.setH(!0),this.setN(!1)},t.prototype.XOR=function(){var t=this.m_mmu.read(this.m_PC),s=7&t;3==(192&t)?(this.m_registers[this.R.A]^=this.m_mmu.read(++this.m_PC),this.m_clock=8):6==s?(this.m_registers[this.R.A]^=this.m_mmu.read(this.getHL()),this.m_clock=8):(this.m_registers[this.R.A]^=this.m_registers[s],this.m_clock=4),this.setZ(0==this.m_registers[this.R.A]),this.setC(!1),this.setH(!1),this.setN(!1)},t.prototype.OR=function(){var t=this.m_mmu.read(this.m_PC),s=7&t;3==(192&t)?(this.m_registers[this.R.A]|=this.m_mmu.read(++this.m_PC),this.m_clock=8):6==s?(this.m_registers[this.R.A]|=this.m_mmu.read(this.getHL()),this.m_clock=8):(this.m_registers[this.R.A]|=this.m_registers[s],this.m_clock=4),this.setZ(0==this.m_registers[this.R.A]),this.setC(!1),this.setH(!1),this.setN(!1)},t.prototype.CP=function(){var t=this.m_registers[this.R.A],s=0,i=this.m_mmu.read(this.m_PC),h=7&i;3==(192&i)?(s=this.m_mmu.read(++this.m_PC),this.m_clock=8):6==h?(s=this.m_mmu.read(this.getHL()),this.m_clock=8):(s=this.m_registers[h],this.m_clock=4),this.setH((t-s&15)>(15&t)),this.setC(s>t),this.setZ(s==t),this.setN(!0)},t.prototype.INC=function(){var t=0,s=56&this.m_mmu.read(this.m_PC);6==s?(this.m_mmu.write(this.getHL(),this.m_mmu.read(this.getHL())+1),t=this.m_mmu.read(this.getHL()),this.m_clock=12):(this.m_registers[s]=this.m_registers[s]+1&255,t=this.m_registers[s],this.m_clock=4),this.setZ(0==t),this.setH(0==(15&t)),this.setN(!1)},t.prototype.DEC=function(){var t=0,s=56&this.m_mmu.read(this.m_PC);6==s?(this.m_mmu.write(this.getHL(),this.m_mmu.read(this.getHL())-1),t=this.m_mmu.read(this.getHL()),this.m_clock=12):(this.m_registers[s]=this.m_registers[s]-1&255,t=this.m_registers[s],this.m_clock=4),this.setZ(0==t),this.setH(15==(15&t)),this.setN(!0)},t.prototype.ADD_16_BIT=function(){var t=this.m_mmu.read(this.m_PC),s=56&t;if(0==(7&t)){var i=this.m_mmu.read(++this.m_PC),h=this.m_SP;this.m_SP=this.m_SP+i&65535,this.setZ(!1),this.setN(!1),this.setH(16==(16&(this.m_SP^h^i))),this.setC(256==(256&(this.m_SP^h^i))),this.m_clock=16}else{switch(h=this.getHL(),s){case 1:this.setHL(this.getHL()+this.getBC());break;case 3:this.setHL(this.getHL()+this.getDE());break;case 5:this.setHL(this.getHL()+this.getHL());break;case 7:this.setHL(this.getHL()+this.m_SP)}this.setN(!1),this.setH((4095&this.getHL())<(4095&h)),this.setC(this.getHL()<h),this.m_clock=8}},t.prototype.INC_16_BIT=function(){switch(56&this.m_mmu.read(this.m_PC)){case 0:this.setBC(this.getBC()+1);break;case 2:this.setDE(this.getDE()+1);break;case 4:this.setHL(this.getHL()+1);break;case 6:this.m_SP=this.m_SP+1&65535}this.m_clock=8},t.prototype.DEC_16_BIT=function(){switch(56&this.m_mmu.read(this.m_PC)){case 0:this.setBC(this.getBC()-1);break;case 2:this.setDE(this.getDE()-1);break;case 4:this.setHL(this.getHL()-1);break;case 6:this.m_SP=this.m_SP-1&65535}this.m_clock=8},t.prototype.CBPrefix=function(){this.m_instructionMethods2},t.prototype.RLC=function(){var t=7&this.m_mmu.read(this.m_PC);if(6==t){var s=this.m_mmu.read(this.getHL());this.setC(s>=128),this.m_mmu.write(this.getHL(),(s<<1)+Number(this.getC())&255),this.setZ(0==this.m_mmu.read(this.getHL())),this.m_clock=16}else s=this.m_registers[t],this.setC(s>=128),this.m_registers[t]=(s<<1)+Number(this.getC())&255,this.m_cbPrefix?(this.setZ(0==this.m_registers[t]),this.m_clock=8):(this.setZ(!1),this.m_clock=4);this.setH(!1),this.setN(!1)},t.prototype.RRC=function(){},t.prototype.RL=function(){},t.prototype.RR=function(){},t.prototype.SLA=function(){},t.prototype.SRA=function(){},t.prototype.SWAP=function(){},t.prototype.SRL=function(){},t.prototype.BIT=function(){},t.prototype.RES=function(){},t.prototype.SET=function(){},t.prototype.CALL=function(){},t.prototype.RET=function(){},t.prototype.RST=function(){},t.prototype.DAA=function(){},t.prototype.CPL=function(){},t.prototype.SCF=function(){},t.prototype.CCF=function(){},t.prototype.DI=function(){},t.prototype.EI=function(){},t.prototype.HALT=function(){},t.prototype.STOP=function(){},t.prototype.opcode00=function(){this.m_clock=4},t.prototype.opcode01=function(){var t=this.m_mmu.read(++this.m_PC),s=this.m_mmu.read(++this.m_PC);this.m_registers[this.R.B]=s,this.m_registers[this.R.C]=t,this.m_clock=12},t.prototype.opcode02=function(){this.m_mmu.write(this.getBC(),this.m_registers[this.R.A]),this.m_clock=8},t.prototype.getBC=function(){return this.m_registers[this.R.B]<<8+this.m_registers[this.R.C]},t.prototype.getDE=function(){return this.m_registers[this.R.D]<<8+this.m_registers[this.R.E]},t.prototype.getHL=function(){return this.m_registers[this.R.E]<<8+this.m_registers[this.R.L]},t.prototype.setAF=function(t){var s=t>>8&255,i=255&t;this.m_registers[this.R.A]=s,this.m_registers[this.R.F]=i},t.prototype.setBC=function(t){var s=t>>8&255,i=255&t;this.m_registers[this.R.B]=s,this.m_registers[this.R.C]=i},t.prototype.setDE=function(t){var s=t>>8&255,i=255&t;this.m_registers[this.R.D]=s,this.m_registers[this.R.E]=i},t.prototype.setHL=function(t){var s=t>>8&255,i=255&t;this.m_registers[this.R.H]=s,this.m_registers[this.R.L]=i},t.prototype.getC=function(){return(16&this.m_registers[this.R.F])>0},t.prototype.getZ=function(){return(128&this.m_registers[this.R.F])>0},t.prototype.setC=function(t){t?this.m_registers[this.R.F]|=16:this.m_registers[this.R.F]&=239},t.prototype.setH=function(t){t?this.m_registers[this.R.F]|=32:this.m_registers[this.R.F]&=223},t.prototype.setN=function(t){t?this.m_registers[this.R.F]|=64:this.m_registers[this.R.F]&=191},t.prototype.setZ=function(t){t?this.m_registers[this.R.F]|=128:this.m_registers[this.R.F]&=127},t}(),s=function(){function t(t,s){this.m_mmu=t,this.m_frame=s,this.VRAM_1=32768,this.VRAM_2=36864,this.TILE_MAP1=38912,this.TILE_MAP2=39936,this.IF=65295,this.LCDC=65344,this.STAT=65345,this.SCY=65346,this.SCX=65347,this.LY=65348,this.LYC=65349,this.BGP=65351,this.WX=65355,this.colorValues=[65535,22197,10666,0],this.state={Mode0:0,Mode1:1,Mode2:2,Mode3:3},this.m_state=this.state.Mode2,this.m_clock=0,this.m_windowLineCounter=0,this.m_bgDotVals=new Array(160).fill(0)}return t.prototype.step=function(){if(0==(128&this.m_mmu.read(this.LCDC))){switch(this.m_state){case this.state.Mode0:this.m_clock>=456&&(this.m_mmu.read(this.LY)>143?(this.m_state=this.state.Mode1,this.m_mmu.write(this.STAT,252&this.m_mmu.read(this.STAT)),this.m_mmu.write(this.STAT,1|this.m_mmu.read(this.STAT)),this.m_mmu.write(this.LY,this.m_mmu.read(this.LY)+1),this.m_mmu.write(this.IF,1|this.m_mmu.read(this.IF)),(16&this.m_mmu.read(this.STAT))>0&&this.m_mmu.write(this.IF,2|this.m_mmu.read(this.IF)),this.m_windowLineCounter=0):(this.m_state=this.state.Mode2,this.m_mmu.write(this.STAT,252&this.m_mmu.read(this.STAT)),this.m_mmu.write(this.STAT,2|this.m_mmu.read(this.STAT)),this.m_mmu.write(this.LY,this.m_mmu.read(this.LY)+1),(32&this.m_mmu.read(this.STAT))>0&&this.m_mmu.write(this.IF,2|this.m_mmu.read(this.IF))),this.m_clock=-1);break;case this.state.Mode1:this.m_clock>=456&&(this.m_mmu.write(this.LY,this.m_mmu.read(this.LY)+1),154==this.m_mmu.read(this.LY)&&(this.m_state=this.state.Mode2,this.m_mmu.write(this.STAT,252&this.m_mmu.read(this.STAT)),this.m_mmu.write(this.STAT,2|this.m_mmu.read(this.STAT)),this.m_mmu.write(this.LY,0),(32&this.m_mmu.read(this.STAT))>0&&this.m_mmu.write(this.IF,2|this.m_mmu.read(this.IF))),this.m_clock=-1);break;case this.state.Mode2:this.m_clock>=80&&(this.m_state=this.state.Mode3,this.m_mmu.write(this.STAT,3|this.m_mmu.read(this.STAT)));break;case this.state.Mode3:this.m_clock>=172&&(this.m_state=this.state.Mode0,this.m_mmu.write(this.STAT,252&this.m_mmu.read(this.STAT)),(128&this.m_mmu.read(this.STAT))>0&&this.m_mmu.write(this.IF,2|this.m_mmu.read(this.IF)),this.renderLine())}this.m_mmu.read(this.LY)==this.m_mmu.read(this.LYC)?0==(4&this.m_mmu.read(this.STAT))&&((64&this.m_mmu.read(this.STAT))>0&&this.m_mmu.write(this.IF,2&this.m_mmu.read(this.IF)),this.m_mmu.write(this.STAT,4|this.m_mmu.read(this.STAT))):this.m_mmu.write(this.STAT,251&this.m_mmu.read(this.STAT)),this.m_clock+=1}},t.prototype.renderLine=function(){(1&this.m_mmu.read(this.LCDC))>0&&this.renderBackgroundLine(),(32&this.m_mmu.read(this.LCDC))>0&&this.renderWindowLine(),(2&this.m_mmu.read(this.LCDC))>0&&this.renderObject()},t.prototype.renderBackgroundLine=function(){for(var t=0;t<160;t++){var s,i=(this.m_mmu.read(this.SCX)+t)%256,h=(this.m_mmu.read(this.SCY)+this.m_mmu.read(this.LY))%256,m=h/8*32+i/8;s=(16&this.m_mmu.read(this.LCDC))>0?(8&this.m_mmu.read(this.LCDC))>0?this.m_mmu.read(this.VRAM_1)+this.m_mmu.read(16*(this.TILE_MAP2+m)):this.m_mmu.read(this.VRAM_1)+this.m_mmu.read(16*(this.TILE_MAP1+m)):(8&this.m_mmu.read(this.LCDC))>0?this.m_mmu.read(this.VRAM_2)+this.m_mmu.read(16*(this.TILE_MAP2+m)):this.m_mmu.read(this.VRAM_2)+this.m_mmu.read(16*(this.TILE_MAP1+m));var e=this.m_mmu.read(s+h%8*2),_=128>>i%8,r=0;(this.m_mmu.read(s+h%8*2+1)&_)>0?(e&_)>0?(r=this.colorValues[(192&this.m_mmu.read(this.BGP))>>6],this.m_bgDotVals[t]=3):(r=this.colorValues[(48&this.m_mmu.read(this.BGP))>>4],this.m_bgDotVals[t]=2):(e&_)>0?(r=this.colorValues[(192&this.m_mmu.read(this.BGP))>>2],this.m_bgDotVals[t]=1):(r=this.colorValues[48&this.m_mmu.read(this.BGP)],this.m_bgDotVals[t]=0),this.m_frame[160*this.m_mmu.read(this.LY)+t]=r}this.m_mmu.read(this.WX)<166&&(this.m_windowLineCounter+=1)},t.prototype.renderWindowLine=function(){this.m_windowLineCounter},t.prototype.renderObject=function(){},t}(),i=function(){function t(){}return t.BIOS_DMG=[49,254,255,175,33,255,159,50,203,124,32,251,33,38,255,14,17,62,128,50,226,12,62,243,226,50,62,119,119,62,252,224,71,17,4,1,33,16,128,26,205,149,0,205,150,0,19,123,254,52,32,243,17,216,0,6,8,26,19,34,35,5,32,249,62,25,234,16,153,33,47,153,14,12,61,40,8,50,13,32,249,46,15,24,243,103,62,100,87,224,66,62,145,224,64,4,30,2,14,12,240,68,254,144,32,250,13,32,247,29,32,242,14,19,36,124,30,131,254,98,40,6,30,193,254,100,32,6,123,226,12,62,135,226,240,66,144,224,66,21,32,210,5,32,79,22,32,24,203,79,6,4,197,203,17,23,193,203,17,23,5,32,245,34,35,34,35,201,206,237,102,102,204,13,0,11,3,115,0,131,0,12,0,13,0,8,17,31,136,137,0,14,220,204,110,230,221,221,217,153,187,187,103,99,110,14,236,204,221,220,153,159,187,185,51,62,60,66,185,165,185,165,66,60,33,4,1,17,168,0,26,19,190,32,254,35,125,254,52,32,245,6,25,120,134,35,5,32,251,134,32,254,62,1,224,80],t}(),h=function(){function t(){this.m_addrBus=Array(65535).fill(0),this.loadBIOS()}return t.prototype.read=function(t){return this.m_addrBus[65535&t]},t.prototype.write=function(t,s){this.m_addrBus[65535&t]=255&s},t.prototype.loadBIOS=function(){for(var t=0;t<i.BIOS_DMG.length;t++)this.m_addrBus[t]=i.BIOS_DMG[t]},t}(),m=function(){function i(i){this.m_path=i,this.m_frame=[23040].fill(0),this.m_mmu=new h,this.m_cpu=new t(this.m_mmu),this.m_gpu=new s(this.m_mmu,this.m_frame),this.m_inVBLANK=!1,this.m_cpu,this.m_gpu,this.m_inVBLANK}return i.prototype.getFrame=function(){for(var t=0;t<100;t++)this.m_cpu.step(),this.m_gpu.step();return this.m_frame},i}(),e=document.getElementById("canvas").getContext("2d"),_=e.createImageData(160,144),r=0,o=new m("TBD");function R(){o.getFrame()}setInterval((function(){var t=_.data;t[4*r]=255,t[4*r+3]=255,e.putImageData(_,0,0),r+=1}),1e3/60),R(),R(),R()})();