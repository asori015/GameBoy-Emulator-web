(()=>{"use strict";var t,s=function(){function t(t){var s=this;this.m_mmu=t,this.m_instructionMethods1=[function(){return 4},function(){return s.m_registers[s.R.C]=s.m_mmu.read(++s.m_PC[0]),s.m_registers[s.R.B]=s.m_mmu.read(++s.m_PC[0]),12},function(){return s.m_mmu.write(s.getBC(),s.m_registers[s.R.A]),8},function(){return s.setBC(s.getBC()+1),8},function(){return s.m_registers[s.R.B]+=1,s.setZ(0==s.m_registers[s.R.B]),s.setH(0==(15&s.m_registers[s.R.B])),s.setN(!1),4},function(){return s.m_registers[s.R.B]-=1,s.setZ(0==s.m_registers[s.R.B]),s.setH(15==(15&s.m_registers[s.R.B])),s.setN(!0),4},function(){return s.m_registers[s.R.B]=s.m_mmu.read(++s.m_PC[0]),8},function(){return s.setC(s.m_registers[s.R.A]>=128),s.m_registers[s.R.A]=(s.m_registers[s.R.A]<<1)+Number(s.getC())&255,s.setZ(!1),s.setH(!1),s.setN(!1),4},function(){var t=s.m_mmu.read(++s.m_PC[0])+(s.m_mmu.read(++s.m_PC[0])<<8);return s.m_mmu.write(t,255&s.m_SP[0]),s.m_mmu.write(t+1,(65280&s.m_SP[0])>>8),20},function(){var t=s.getHL();return s.setHL(s.getHL()+s.getBC()),s.setN(!1),s.setH((4095&s.getHL())<(4095&t)),s.setC(s.getHL()<t),8},function(){return s.m_registers[s.R.A]=s.m_mmu.read(s.getBC()),8},function(){return s.setBC(s.getBC()-1),8},function(){return s.m_registers[s.R.C]+=1,s.setZ(0==s.m_registers[s.R.C]),s.setH(0==(15&s.m_registers[s.R.C])),s.setN(!1),4},function(){return s.m_registers[s.R.C]-=1,s.setZ(0==s.m_registers[s.R.C]),s.setH(15==(15&s.m_registers[s.R.C])),s.setN(!0),4},function(){return s.m_registers[s.R.C]=s.m_mmu.read(++s.m_PC[0]),8},function(){return s.setC(s.m_registers[s.R.A]%2>0),s.m_registers[s.R.A]=(s.m_registers[s.R.A]>>1)+(Number(s.getC())<<7),s.setZ(!1),s.setH(!1),s.setN(!1),4},this.STOP,function(){return s.m_registers[s.R.E]=s.m_mmu.read(++s.m_PC[0]),s.m_registers[s.R.D]=s.m_mmu.read(++s.m_PC[0]),12},function(){return s.m_mmu.write(s.getDE(),s.m_registers[s.R.A]),8},function(){return s.setDE(s.getDE()+1),8},function(){return s.m_registers[s.R.D]+=1,s.setZ(0==s.m_registers[s.R.D]),s.setH(0==(15&s.m_registers[s.R.D])),s.setN(!1),4},function(){return s.m_registers[s.R.D]-=1,s.setZ(0==s.m_registers[s.R.D]),s.setH(15==(15&s.m_registers[s.R.D])),s.setN(!0),4},function(){return s.m_registers[s.R.D]=s.m_mmu.read(++s.m_PC[0]),8},this.RL,this.JR,function(){var t=s.getHL();return s.setHL(s.getHL()+s.getDE()),s.setN(!1),s.setH((4095&s.getHL())<(4095&t)),s.setC(s.getHL()<t),8},function(){return s.m_registers[s.R.A]=s.m_mmu.read(s.getDE()),8},function(){return s.setDE(s.getDE()-1),8},function(){return s.m_registers[s.R.E]+=1,s.setZ(0==s.m_registers[s.R.E]),s.setH(0==(15&s.m_registers[s.R.E])),s.setN(!1),4},function(){return s.m_registers[s.R.E]-=1,s.setZ(0==s.m_registers[s.R.E]),s.setH(15==(15&s.m_registers[s.R.E])),s.setN(!0),4},function(){return s.m_registers[s.R.E]=s.m_mmu.read(++s.m_PC[0]),8},this.RR,this.JR,function(){return s.m_registers[s.R.L]=s.m_mmu.read(++s.m_PC[0]),s.m_registers[s.R.H]=s.m_mmu.read(++s.m_PC[0]),12},function(){return s.m_mmu.write(s.getHL(),s.m_registers[s.R.A]),s.setHL(s.getHL()+1),8},function(){return s.setHL(s.getHL()+1),8},function(){return s.m_registers[s.R.H]+=1,s.setZ(0==s.m_registers[s.R.H]),s.setH(0==(15&s.m_registers[s.R.H])),s.setN(!1),4},function(){return s.m_registers[s.R.H]-=1,s.setZ(0==s.m_registers[s.R.H]),s.setH(15==(15&s.m_registers[s.R.H])),s.setN(!0),4},function(){return s.m_registers[s.R.H]=s.m_mmu.read(++s.m_PC[0]),8},this.DAA,this.JR,function(){var t=s.getHL();return s.setHL(s.getHL()+s.getHL()),s.setN(!1),s.setH((4095&s.getHL())<(4095&t)),s.setC(s.getHL()<t),8},function(){return s.m_registers[s.R.A]=s.m_mmu.read(s.getHL()),s.setHL(s.getHL()+1),8},function(){return s.setHL(s.getHL()-1),8},function(){return s.m_registers[s.R.L]+=1,s.setZ(0==s.m_registers[s.R.L]),s.setH(0==(15&s.m_registers[s.R.L])),s.setN(!1),4},function(){return s.m_registers[s.R.L]-=1,s.setZ(0==s.m_registers[s.R.L]),s.setH(15==(15&s.m_registers[s.R.L])),s.setN(!0),4},function(){return s.m_registers[s.R.L]=s.m_mmu.read(++s.m_PC[0]),8},function(){return s.m_registers[s.R.A]=255-s.m_registers[s.R.A],s.setN(!0),s.setH(!0),4},this.JR,function(){return s.m_SP[0]=s.m_mmu.read(++s.m_PC[0])+(s.m_mmu.read(++s.m_PC[0])<<8),12},function(){return s.m_mmu.write(s.getHL(),s.m_registers[s.R.A]),s.setHL(s.getHL()-1),8},function(){return s.m_SP[0]+=1,8},function(){return s.m_mmu.write(s.getHL(),s.m_mmu.read(s.getHL())+1),s.setZ(0==s.m_mmu.read(s.getHL())),s.setH(0==(15&s.m_mmu.read(s.getHL()))),s.setN(!1),12},function(){return s.m_mmu.write(s.getHL(),s.m_mmu.read(s.getHL())-1),s.setZ(0==s.m_mmu.read(s.getHL())),s.setH(15==(15&s.m_mmu.read(s.getHL()))),s.setN(!0),12},function(){return s.m_mmu.write(s.getHL(),s.m_mmu.read(++s.m_PC[0])),8},function(){return s.setN(!1),s.setH(!1),s.setC(!0),4},this.JR,function(){var t=s.getHL();return s.setHL(s.getHL()+s.m_SP[0]),s.setN(!1),s.setH((4095&s.getHL())<(4095&t)),s.setC(s.getHL()<t),8},function(){return s.m_registers[s.R.A]=s.m_mmu.read(s.getHL()),s.setHL(s.getHL()-1),8},function(){return s.m_SP[0]-=1,8},function(){return s.m_registers[s.R.A]+=1,s.setZ(0==s.m_registers[s.R.A]),s.setH(0==(15&s.m_registers[s.R.A])),s.setN(!1),4},function(){return s.m_registers[s.R.A]-=1,s.setZ(0==s.m_registers[s.R.A]),s.setH(15==(15&s.m_registers[s.R.A])),s.setN(!0),4},function(){return s.m_registers[s.R.A]=s.m_mmu.read(++s.m_PC[0]),8},function(){return s.setN(!1),s.setH(!1),s.setC(!s.getC()),4},function(){return s.m_registers[s.R.B]=s.m_registers[s.R.B],4},function(){return s.m_registers[s.R.B]=s.m_registers[s.R.C],4},function(){return s.m_registers[s.R.B]=s.m_registers[s.R.D],4},function(){return s.m_registers[s.R.B]=s.m_registers[s.R.E],4},function(){return s.m_registers[s.R.B]=s.m_registers[s.R.H],4},function(){return s.m_registers[s.R.B]=s.m_registers[s.R.L],4},function(){return s.m_registers[s.R.B]=s.m_mmu.read(s.getHL()),8},function(){return s.m_registers[s.R.B]=s.m_registers[s.R.A],4},function(){return s.m_registers[s.R.C]=s.m_registers[s.R.B],4},function(){return s.m_registers[s.R.C]=s.m_registers[s.R.C],4},function(){return s.m_registers[s.R.C]=s.m_registers[s.R.D],4},function(){return s.m_registers[s.R.C]=s.m_registers[s.R.E],4},function(){return s.m_registers[s.R.C]=s.m_registers[s.R.H],4},function(){return s.m_registers[s.R.C]=s.m_registers[s.R.L],4},function(){return s.m_registers[s.R.C]=s.m_mmu.read(s.getHL()),8},function(){return s.m_registers[s.R.C]=s.m_registers[s.R.A],4},function(){return s.m_registers[s.R.D]=s.m_registers[s.R.B],4},function(){return s.m_registers[s.R.D]=s.m_registers[s.R.C],4},function(){return s.m_registers[s.R.D]=s.m_registers[s.R.D],4},function(){return s.m_registers[s.R.D]=s.m_registers[s.R.E],4},function(){return s.m_registers[s.R.D]=s.m_registers[s.R.H],4},function(){return s.m_registers[s.R.D]=s.m_registers[s.R.L],4},function(){return s.m_registers[s.R.D]=s.m_mmu.read(s.getHL()),8},function(){return s.m_registers[s.R.D]=s.m_registers[s.R.A],4},function(){return s.m_registers[s.R.E]=s.m_registers[s.R.B],4},function(){return s.m_registers[s.R.E]=s.m_registers[s.R.C],4},function(){return s.m_registers[s.R.E]=s.m_registers[s.R.D],4},function(){return s.m_registers[s.R.E]=s.m_registers[s.R.E],4},function(){return s.m_registers[s.R.E]=s.m_registers[s.R.H],4},function(){return s.m_registers[s.R.E]=s.m_registers[s.R.L],4},function(){return s.m_registers[s.R.E]=s.m_mmu.read(s.getHL()),8},function(){return s.m_registers[s.R.E]=s.m_registers[s.R.A],4},function(){return s.m_registers[s.R.H]=s.m_registers[s.R.B],4},function(){return s.m_registers[s.R.H]=s.m_registers[s.R.C],4},function(){return s.m_registers[s.R.H]=s.m_registers[s.R.D],4},function(){return s.m_registers[s.R.H]=s.m_registers[s.R.E],4},function(){return s.m_registers[s.R.H]=s.m_registers[s.R.H],4},function(){return s.m_registers[s.R.H]=s.m_registers[s.R.L],4},function(){return s.m_registers[s.R.H]=s.m_mmu.read(s.getHL()),8},function(){return s.m_registers[s.R.H]=s.m_registers[s.R.A],4},function(){return s.m_registers[s.R.L]=s.m_registers[s.R.B],4},function(){return s.m_registers[s.R.L]=s.m_registers[s.R.C],4},function(){return s.m_registers[s.R.L]=s.m_registers[s.R.D],4},function(){return s.m_registers[s.R.L]=s.m_registers[s.R.E],4},function(){return s.m_registers[s.R.L]=s.m_registers[s.R.H],4},function(){return s.m_registers[s.R.L]=s.m_registers[s.R.L],4},function(){return s.m_registers[s.R.L]=s.m_mmu.read(s.getHL()),8},function(){return s.m_registers[s.R.L]=s.m_registers[s.R.A],4},function(){return s.m_mmu.write(s.getHL(),s.m_registers[s.R.B]),8},function(){return s.m_mmu.write(s.getHL(),s.m_registers[s.R.C]),8},function(){return s.m_mmu.write(s.getHL(),s.m_registers[s.R.D]),8},function(){return s.m_mmu.write(s.getHL(),s.m_registers[s.R.E]),8},function(){return s.m_mmu.write(s.getHL(),s.m_registers[s.R.H]),8},function(){return s.m_mmu.write(s.getHL(),s.m_registers[s.R.L]),8},function(){return s.m_isHalted=!0,4},function(){return s.m_mmu.write(s.getHL(),s.m_registers[s.R.A]),8},function(){return s.m_registers[s.R.A]=s.m_registers[s.R.B],4},function(){return s.m_registers[s.R.A]=s.m_registers[s.R.C],4},function(){return s.m_registers[s.R.A]=s.m_registers[s.R.D],4},function(){return s.m_registers[s.R.A]=s.m_registers[s.R.E],4},function(){return s.m_registers[s.R.A]=s.m_registers[s.R.H],4},function(){return s.m_registers[s.R.A]=s.m_registers[s.R.L],4},function(){return s.m_registers[s.R.A]=s.m_mmu.read(s.getHL()),8},function(){return s.m_registers[s.R.A]=s.m_registers[s.R.A],4},this.ADD,this.ADD,this.ADD,this.ADD,this.ADD,this.ADD,this.ADD,this.ADD,this.ADD,this.ADD,this.ADD,this.ADD,this.ADD,this.ADD,this.ADD,this.ADD,this.SUB,this.SUB,this.SUB,this.SUB,this.SUB,this.SUB,this.SUB,this.SUB,this.SUB,this.SUB,this.SUB,this.SUB,this.SUB,this.SUB,this.SUB,this.SUB,this.AND,this.AND,this.AND,this.AND,this.AND,this.AND,this.AND,this.AND,this.XOR,this.XOR,this.XOR,this.XOR,this.XOR,this.XOR,this.XOR,this.XOR,this.OR,this.OR,this.OR,this.OR,this.OR,this.OR,this.OR,this.OR,this.CP,this.CP,this.CP,this.CP,this.CP,this.CP,this.CP,this.CP,this.RET,function(){return s.m_registers[s.R.C]=s.m_mmu.read(s.m_SP[0]++),s.m_registers[s.R.B]=s.m_mmu.read(s.m_SP[0]++),12},this.JP,this.JP,this.CALL,function(){return s.m_mmu.write(--s.m_SP[0],s.m_registers[s.R.B]),s.m_mmu.write(--s.m_SP[0],s.m_registers[s.R.C]),16},this.ADD,this.RST,this.RET,this.RET,this.JP,function(){s.m_cbPrefix=!0;var t=s.m_instructionMethods2[s.m_mmu.read(++s.m_PC[0])].call(s);return s.m_cbPrefix=!1,t},this.CALL,this.CALL,this.ADD,this.RST,this.RET,function(){return s.m_registers[s.R.E]=s.m_mmu.read(s.m_SP[0]++),s.m_registers[s.R.D]=s.m_mmu.read(s.m_SP[0]++),12},this.JP,this.opcode00,this.CALL,function(){return s.m_mmu.write(--s.m_SP[0],s.m_registers[s.R.D]),s.m_mmu.write(--s.m_SP[0],s.m_registers[s.R.E]),16},this.SUB,this.RST,this.RET,this.RET,this.JP,this.opcode00,this.CALL,this.opcode00,this.SUB,this.RST,function(){return s.m_mmu.write(65280+s.m_mmu.read(++s.m_PC[0]),s.m_registers[s.R.A]),12},function(){return s.m_registers[s.R.L]=s.m_mmu.read(s.m_SP[0]++),s.m_registers[s.R.H]=s.m_mmu.read(s.m_SP[0]++),12},function(){return s.m_mmu.write(65280+s.m_registers[s.R.C],s.m_registers[s.R.A]),8},this.opcode00,this.opcode00,function(){return s.m_mmu.write(--s.m_SP[0],s.m_registers[s.R.H]),s.m_mmu.write(--s.m_SP[0],s.m_registers[s.R.L]),16},this.AND,this.RST,function(){var t=s.m_mmu.read(++s.m_PC[0])<<24>>24,i=s.m_SP[0];return s.m_SP[0]+=t,s.setZ(!1),s.setN(!1),s.setH(16==(16&(s.m_SP[0]^i^t))),s.setC(256==(256&(s.m_SP[0]^i^t))),16},this.JP,function(){return s.m_mmu.write(s.m_mmu.read(++s.m_PC[0])+(s.m_mmu.read(++s.m_PC[0])<<8),s.m_registers[s.R.A]),16},this.opcode00,this.opcode00,this.opcode00,this.XOR,this.RST,function(){return s.m_registers[s.R.A]=s.m_mmu.read(65280+s.m_mmu.read(++s.m_PC[0])),12},function(){return s.m_registers[s.R.F]=240&s.m_mmu.read(s.m_SP[0]++),s.m_registers[s.R.A]=s.m_mmu.read(s.m_SP[0]++),12},function(){return s.m_registers[s.R.A]=s.m_mmu.read(65280+s.m_registers[s.R.C]),8},function(){return s.IME=!1,4},this.opcode00,function(){return s.m_mmu.write(--s.m_SP[0],s.m_registers[s.R.A]),s.m_mmu.write(--s.m_SP[0],s.m_registers[s.R.F]),16},this.OR,this.RST,function(){var t=s.m_mmu.read(++s.m_PC[0])<<24>>24;return s.setHL(s.m_SP[0]+t),s.setZ(!1),s.setN(!1),s.setH(16==(16&(s.m_SP[0]^s.getHL()^t))),s.setC(256==(256&(s.m_SP[0]^s.getHL()^t))),12},function(){return s.m_SP[0]=s.getHL(),8},function(){return s.m_registers[s.R.A]=s.m_mmu.read(s.m_mmu.read(++s.m_PC[0])+(s.m_mmu.read(++s.m_PC[0])<<8)),16},function(){return s.IME=!0,4},this.opcode00,this.opcode00,this.CP,this.RST],this.m_instructionMethods2=[this.RLC,this.RLC,this.RLC,this.RLC,this.RLC,this.RLC,this.RLC,this.RLC,this.RRC,this.RRC,this.RRC,this.RRC,this.RRC,this.RRC,this.RRC,this.RRC,this.RL,this.RL,this.RL,this.RL,this.RL,this.RL,this.RL,this.RL,this.RR,this.RR,this.RR,this.RR,this.RR,this.RR,this.RR,this.RR,this.SLA,this.SLA,this.SLA,this.SLA,this.SLA,this.SLA,this.SLA,this.SLA,this.SRA,this.SRA,this.SRA,this.SRA,this.SRA,this.SRA,this.SRA,this.SRA,this.SWAP,this.SWAP,this.SWAP,this.SWAP,this.SWAP,this.SWAP,this.SWAP,this.SWAP,this.SRL,this.SRL,this.SRL,this.SRL,this.SRL,this.SRL,this.SRL,this.SRL,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.BIT,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.RES,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET,this.SET],this.P1=65280,this.DIV=65283,this.TIMA=65285,this.TMA=65286,this.TAC=65287,this.IF=65295,this.IE=65535,this.R={A:7,B:0,C:1,D:2,E:3,F:6,H:4,L:5},this.debug=!1,this.counter=1,this.m_jstate1=0,this.m_jstate2=0,this.m_BIOSMapped=!0,this.m_PC=new Uint16Array([0]),this.m_SP=new Uint16Array([0]),this.m_clock=0,this.m_sysClock=0,this.m_registers=new Uint8Array(8),this.IME=!1,this.m_cbPrefix=!1,this.m_isHalted=!1,this.m_fallingEdgeDelay=!1}return t.prototype.step=function(){16&this.m_mmu.read(this.P1)?this.m_mmu.write(this.P1,this.m_mmu.read(this.P1)|this.m_jstate2):this.m_mmu.write(this.P1,this.m_mmu.read(this.P1)|this.m_jstate1),0==this.m_sysClock?(this.getInput(),this.m_sysClock=1e3):this.m_sysClock-=1,this.updateTimer(),this.checkForInterupts(),this.m_isHalted||(0==this.m_clock&&this.execute(this.m_mmu.read(this.m_PC[0])),this.m_clock-=1)},t.prototype.getInput=function(){1&this.m_jstate1||this.m_mmu.write(this.IF,16|this.m_mmu.read(this.IF)),this.m_jstate1|=1,2&this.m_jstate1||this.m_mmu.write(this.IF,16|this.m_mmu.read(this.IF)),this.m_jstate1|=2,4&this.m_jstate1||this.m_mmu.write(this.IF,16|this.m_mmu.read(this.IF)),this.m_jstate1|=4,8&this.m_jstate1||this.m_mmu.write(this.IF,16|this.m_mmu.read(this.IF)),this.m_jstate1|=8,1&this.m_jstate2||this.m_mmu.write(this.IF,16|this.m_mmu.read(this.IF)),this.m_jstate2|=1,2&this.m_jstate2||this.m_mmu.write(this.IF,16|this.m_mmu.read(this.IF)),this.m_jstate2|=2,4&this.m_jstate2||this.m_mmu.write(this.IF,16|this.m_mmu.read(this.IF)),this.m_jstate2|=4,8&this.m_jstate2||this.m_mmu.write(this.IF,16|this.m_mmu.read(this.IF)),this.m_jstate2|=8},t.prototype.updateTimer=function(){var t=(this.m_mmu.read(this.DIV)<<8)+this.m_mmu.read(this.DIV+1);if(t+=1,(4&this.m_mmu.read(this.TAC))>0){var s=this.m_mmu.read(this.TIMA);(3&this.m_mmu.read(this.TAC))>0?(t&2<<2*(3&this.m_mmu.read(this.TAC)))>0?this.m_fallingEdgeDelay=!0:this.m_fallingEdgeDelay&&(s+=1,this.m_fallingEdgeDelay=!1):(512&t)>0?this.m_fallingEdgeDelay=!0:this.m_fallingEdgeDelay&&(s+=1,this.m_fallingEdgeDelay=!1),s>255?(this.m_mmu.write(this.TIMA,this.m_mmu.read(this.TMA)),this.m_mmu.write(this.IF,4|this.m_mmu.read(this.IF))):this.m_mmu.write(this.TIMA,255&s)}this.m_mmu.write(this.DIV,t>>8&255),this.m_mmu.write(this.DIV+1,255&t)},t.prototype.checkForInterupts=function(){if(this.m_mmu.read(this.IF)>0&&this.m_mmu.read(this.IE)>0)for(var t=1,s=0;s<5;s++){if(this.m_mmu.read(this.IF)&t&&this.m_mmu.read(this.IE)&t){this.m_isHalted=!1,this.IME&&(this.IME=!1,this.m_mmu.write(this.IF,this.m_mmu.read(this.IF)&255-t),this.m_mmu.write(--this.m_SP[0],this.m_PC[0]>>8),this.m_mmu.write(--this.m_SP[0],255&this.m_PC[0]),this.m_PC[0]=64+8*s,this.m_clock=4);break}t<<=1}},t.prototype.execute=function(t){475==this.m_PC[0]&&(this.debug=!0),140==this.m_mmu.read(65348)&&(0==this.counter&&(this.debug=!1),this.counter-=1),this.debug,this.m_clock=this.m_instructionMethods1[t].call(this),this.m_PC[0]+=1},t.prototype.JP=function(){var t=this.m_mmu.read(this.m_PC[0]),s=(56&t)>>3,i=7&t;if(1==i)return this.m_PC[0]=this.getHL()-1&65535,4;var e=this.m_mmu.read(++this.m_PC[0]),r=this.m_mmu.read(++this.m_PC[0]);if(2==i)switch(s){case 0:if(this.getZ())return 12;break;case 1:if(!this.getZ())return 12;break;case 2:if(this.getC())return 12;break;case 3:if(!this.getC())return 12}return this.m_PC[0]=(r<<8)+e-1&65535,16},t.prototype.JR=function(){var t=(56&this.m_mmu.read(this.m_PC[0]))>>3,s=this.m_mmu.read(++this.m_PC[0]);if(3!=t)switch(t){case 4:if(this.getZ())return 8;break;case 5:if(!this.getZ())return 8;break;case 6:if(this.getC())return 8;break;case 7:if(!this.getC())return 8}return this.m_PC[0]+=s<<24>>24,12},t.prototype.ADD=function(){var t=this.m_registers[this.R.A],s=0,i=0,e=this.m_mmu.read(this.m_PC[0]),r=(192&e)>>6,m=7&e;return 1==(56&e)>>3&&(i=Number(this.getC())),3==r?(s=this.m_mmu.read(++this.m_PC[0]),this.m_clock=8):6==m?(s=this.m_mmu.read(this.getHL()),this.m_clock=8):(s=this.m_registers[m],this.m_clock=4),this.m_registers[this.R.A]=t+s+i&255,this.setZ(0==this.m_registers[this.R.A]),this.setN(!1),this.setH((15&t)+(15&s)+i>15),this.setC(t+s+i>255),4},t.prototype.SUB=function(){var t=this.m_registers[this.R.A],s=0,i=0,e=this.m_mmu.read(this.m_PC[0]),r=(192&e)>>6,m=7&e;return 3==(56&e)>>3&&(i=Number(this.getC())),3==r?(s=this.m_mmu.read(++this.m_PC[0]),this.m_clock=8):6==m?(s=this.m_mmu.read(this.getHL()),this.m_clock=8):(s=this.m_registers[m],this.m_clock=4),this.setH((15&t)<(15&s)+i),this.m_registers[this.R.A]=t-s-i&255,this.setC(s+i>t),this.setZ(0==this.m_registers[this.R.A]),this.setN(!0),4},t.prototype.AND=function(){var t=this.m_mmu.read(this.m_PC[0]),s=7&t;return 3==(192&t)>>6?(this.m_registers[this.R.A]&=this.m_mmu.read(++this.m_PC[0]),this.m_clock=8):6==s?(this.m_registers[this.R.A]&=this.m_mmu.read(this.getHL()),this.m_clock=8):(this.m_registers[this.R.A]&=this.m_registers[s],this.m_clock=4),this.setZ(0==this.m_registers[this.R.A]),this.setC(!1),this.setH(!0),this.setN(!1),4},t.prototype.XOR=function(){var t=this.m_mmu.read(this.m_PC[0]),s=7&t;return 3==(192&t)>>6?(this.m_registers[this.R.A]^=this.m_mmu.read(++this.m_PC[0]),this.m_clock=8):6==s?(this.m_registers[this.R.A]^=this.m_mmu.read(this.getHL()),this.m_clock=8):(this.m_registers[this.R.A]^=this.m_registers[s],this.m_clock=4),this.setZ(0==this.m_registers[this.R.A]),this.setC(!1),this.setH(!1),this.setN(!1),4},t.prototype.OR=function(){var t=this.m_mmu.read(this.m_PC[0]),s=7&t;return 3==(192&t)>>6?(this.m_registers[this.R.A]|=this.m_mmu.read(++this.m_PC[0]),this.m_clock=8):6==s?(this.m_registers[this.R.A]|=this.m_mmu.read(this.getHL()),this.m_clock=8):(this.m_registers[this.R.A]|=this.m_registers[s],this.m_clock=4),this.setZ(0==this.m_registers[this.R.A]),this.setC(!1),this.setH(!1),this.setN(!1),4},t.prototype.CP=function(){var t=this.m_registers[this.R.A],s=0,i=this.m_mmu.read(this.m_PC[0]),e=7&i;return 3==(192&i)>>6?(s=this.m_mmu.read(++this.m_PC[0]),this.m_clock=8):6==e?(s=this.m_mmu.read(this.getHL()),this.m_clock=8):(s=this.m_registers[e],this.m_clock=4),this.setH((t-s&15)>(15&t)),this.setC(s>t),this.setZ(s==t),this.setN(!0),4},t.prototype.RLC=function(){var t=7&this.m_mmu.read(this.m_PC[0]);if(6==t){var s=this.m_mmu.read(this.getHL());this.setC(s>=128),this.m_mmu.write(this.getHL(),(s<<1)+Number(this.getC())&255),this.setZ(0==this.m_mmu.read(this.getHL())),this.m_clock=16}else s=this.m_registers[t],this.setC(s>=128),this.m_registers[t]=(s<<1)+Number(this.getC())&255,this.m_cbPrefix?(this.setZ(0==this.m_registers[t]),this.m_clock=8):(this.setZ(!1),this.m_clock=4);return this.setH(!1),this.setN(!1),8},t.prototype.RRC=function(){var t=7&this.m_mmu.read(this.m_PC[0]);if(6==t){var s=this.m_mmu.read(this.getHL());this.setC(s%2>0),this.m_mmu.write(this.getHL(),(s>>1)+(Number(this.getC())<<7)),this.setZ(0==this.m_mmu.read(this.getHL())),this.m_clock=16}else s=this.m_registers[t],this.setC(s%2>0),this.m_registers[t]=(s>>1)+(Number(this.getC())<<7),this.m_cbPrefix?(this.setZ(0==this.m_registers[t]),this.m_clock=8):(this.setZ(!1),this.m_clock=4);return this.setH(!1),this.setN(!1),4},t.prototype.RL=function(){var t=7&this.m_mmu.read(this.m_PC[0]);if(6==t){var s=this.m_mmu.read(this.getHL());this.m_mmu.write(this.getHL(),(s<<1)+Number(this.getC())),this.setC(s>=128),this.setZ(0==this.m_mmu.read(this.getHL())),this.m_clock=16}else s=this.m_registers[t],this.m_registers[t]=(s<<1)+Number(this.getC())&255,this.setC(s>=128),this.m_cbPrefix?(this.setZ(0==this.m_registers[t]),this.m_clock=8):(this.setZ(!1),this.m_clock=4);return this.setH(!1),this.setN(!1),8},t.prototype.RR=function(){var t=7&this.m_mmu.read(this.m_PC[0]);if(6==t){var s=this.m_mmu.read(this.getHL());this.m_mmu.write(this.getHL(),(s>>1)+(Number(this.getC())<<7)),this.setC(s%2>0),this.setZ(0==this.m_mmu.read(this.getHL())),this.m_clock=16}else s=this.m_registers[t],this.m_registers[t]=(s>>1)+(Number(this.getC())<<7),this.setC(s%2>0),this.m_cbPrefix?(this.setZ(0==this.m_registers[t]),this.m_clock=8):(this.setZ(!1),this.m_clock=4);return this.setH(!1),this.setN(!1),8},t.prototype.SLA=function(){var t=7&this.m_mmu.read(this.m_PC[0]);if(6==t){var s=this.m_mmu.read(this.getHL());this.setC(s>=128),this.m_mmu.write(this.getHL(),s<<1),this.setZ(0==this.m_mmu.read(this.getHL())),this.m_clock=16}else s=this.m_registers[t],this.setC(s>=128),this.m_registers[t]=s<<1&255,this.setZ(0==this.m_registers[t]),this.m_clock=8;return this.setH(!1),this.setN(!1),8},t.prototype.SRA=function(){var t=7&this.m_mmu.read(this.m_PC[0]);if(6==t){var s=this.m_mmu.read(this.getHL());this.setC(s>=128),this.m_mmu.write(this.getHL(),(s>>1)+(Number(this.getC())<<7)),this.setC(s%2>0),this.setZ(0==this.m_mmu.read(this.getHL())),this.m_clock=16}else s=this.m_registers[t],this.setC(s>=128),this.m_registers[t]=(s>>1)+(Number(this.getC())<<7),this.setC(s%2>0),this.setZ(0==this.m_registers[t]),this.m_clock=8;return this.setH(!1),this.setN(!1),8},t.prototype.SWAP=function(){var t=7&this.m_mmu.read(this.m_PC[0]);if(6==t){var s=this.m_mmu.read(this.getHL());this.m_mmu.write(this.getHL(),(s<<4)+(s>>4)),this.setZ(0==this.m_mmu.read(this.getHL())),this.m_clock=16}else s=this.m_registers[t],this.m_registers[t]=(s<<4)+(s>>4)&255,this.setZ(0==this.m_registers[t]),this.m_clock=8;return this.setC(!1),this.setH(!1),this.setN(!1),8},t.prototype.SRL=function(){var t=7&this.m_mmu.read(this.m_PC[0]);if(6==t){var s=this.m_mmu.read(this.getHL());this.setC(s%2>0),this.m_mmu.write(this.getHL(),s>>1),this.setZ(0==this.m_mmu.read(this.getHL())),this.m_clock=16}else s=this.m_registers[t],this.setC(s%2>0),this.m_registers[t]=s>>1,this.setZ(0==this.m_registers[t]),this.m_clock=8;return this.setH(!1),this.setN(!1),8},t.prototype.BIT=function(){var t=this.m_mmu.read(this.m_PC[0]),s=7&t,i=1<<((56&t)>>3);return 6==s?(this.setZ(0==(this.m_mmu.read(this.getHL())&i)),this.m_clock=12):(this.setZ(0==(this.m_registers[s]&i)),this.m_clock=8),this.setH(!0),this.setN(!1),8},t.prototype.RES=function(){var t=this.m_mmu.read(this.m_PC[0]),s=7&t,i=1<<((56&t)>>3)^255;return 6==s?(this.m_mmu.write(this.getHL(),this.m_mmu.read(this.getHL())&i),this.m_clock=16):(this.m_registers[s]&=255&i,this.m_clock=8),8},t.prototype.SET=function(){var t=this.m_mmu.read(this.m_PC[0]),s=7&t,i=1<<((56&t)>>3);return 6==s?(this.m_mmu.write(this.getHL(),this.m_mmu.read(this.getHL())|i),this.m_clock=16):(this.m_registers[s]|=255&i,this.m_clock=8),8},t.prototype.CALL=function(){var t=this.m_mmu.read(this.m_PC[0]),s=(56&t)>>3,i=7&t,e=this.m_mmu.read(++this.m_PC[0]),r=this.m_mmu.read(++this.m_PC[0]);if(4==i)switch(s){case 0:if(this.getZ())return 12;break;case 1:if(!this.getZ())return 12;break;case 2:if(this.getC())return 12;break;case 3:if(!this.getC())return 12}return this.m_PC[0]+=1,this.m_mmu.write(--this.m_SP[0],(65280&this.m_PC[0])>>8),this.m_mmu.write(--this.m_SP[0],255&this.m_PC[0]),this.m_PC[0]=(r<<8)+e-1,24},t.prototype.RET=function(){var t=this.m_mmu.read(this.m_PC[0]),s=(56&t)>>3;if(0==(7&t)){switch(this.m_clock=8,s){case 0:if(this.getZ())return 8;break;case 1:if(!this.getZ())return 8;break;case 2:if(this.getC())return 8;break;case 3:if(!this.getC())return 8}this.m_clock=20}else 3==s&&(this.IME=!0),this.m_clock=16;var i=this.m_mmu.read(this.m_SP[0]++),e=this.m_mmu.read(this.m_SP[0]++);return this.m_PC[0]=(e<<8)+i-1,16},t.prototype.RST=function(){var t=(56&this.m_mmu.read(this.m_PC[0]))>>3;return this.m_PC[0]+=1,this.m_mmu.write(--this.m_SP[0],(65280&this.m_PC[0])>>8),this.m_mmu.write(--this.m_SP[0],255&this.m_PC[0]),this.m_PC[0]=8*t-1,16},t.prototype.DAA=function(){return this.getN()?this.getC()?this.getH()?this.m_registers[this.R.A]=this.m_registers[this.R.A]+154&255:this.m_registers[this.R.A]=this.m_registers[this.R.A]+160&255:this.getH()&&(this.m_registers[this.R.A]=this.m_registers[this.R.A]+250&255):((this.getC()||this.m_registers[this.R.A]>153)&&(this.m_registers[this.R.A]=this.m_registers[this.R.A]+96&255,this.setC(!0)),(this.getH()||(15&this.m_registers[this.R.A])>9)&&(this.m_registers[this.R.A]=this.m_registers[this.R.A]+6&255)),this.setZ(0==this.m_registers[this.R.A]),this.setH(!1),4},t.prototype.STOP=function(){return 4},t.prototype.opcode00=function(){return 4},t.prototype.getBC=function(){return(this.m_registers[this.R.B]<<8)+this.m_registers[this.R.C]},t.prototype.getDE=function(){return(this.m_registers[this.R.D]<<8)+this.m_registers[this.R.E]},t.prototype.getHL=function(){return(this.m_registers[this.R.H]<<8)+this.m_registers[this.R.L]},t.prototype.setBC=function(t){var s=t>>8&255,i=255&t;this.m_registers[this.R.B]=s,this.m_registers[this.R.C]=i},t.prototype.setDE=function(t){var s=t>>8&255,i=255&t;this.m_registers[this.R.D]=s,this.m_registers[this.R.E]=i},t.prototype.setHL=function(t){var s=t>>8&255,i=255&t;this.m_registers[this.R.H]=s,this.m_registers[this.R.L]=i},t.prototype.getC=function(){return(16&this.m_registers[this.R.F])>0},t.prototype.getH=function(){return(32&this.m_registers[this.R.F])>0},t.prototype.getN=function(){return(64&this.m_registers[this.R.F])>0},t.prototype.getZ=function(){return(128&this.m_registers[this.R.F])>0},t.prototype.setC=function(t){t?this.m_registers[this.R.F]|=16:this.m_registers[this.R.F]&=239},t.prototype.setH=function(t){t?this.m_registers[this.R.F]|=32:this.m_registers[this.R.F]&=223},t.prototype.setN=function(t){t?this.m_registers[this.R.F]|=64:this.m_registers[this.R.F]&=191},t.prototype.setZ=function(t){t?this.m_registers[this.R.F]|=128:this.m_registers[this.R.F]&=127},t}(),i=function(){function t(t,s){this.m_mmu=t,this.m_frame=s,this.VRAM_1=32768,this.VRAM_2=36864,this.TILE_MAP1=38912,this.TILE_MAP2=39936,this.OAM=65024,this.IF=65295,this.LCDC=65344,this.STAT=65345,this.SCY=65346,this.SCX=65347,this.LY=65348,this.LYC=65349,this.BGP=65351,this.OBP0=65352,this.OBP1=65353,this.WY=65354,this.WX=65355,this.colorValues=[65535,22197,10666,0],this.state={Mode0:0,Mode1:1,Mode2:2,Mode3:3},this.m_state=this.state.Mode2,this.m_clock=0,this.m_windowLineCounter=0,this.m_bgDotVals=new Array(160).fill(0)}return t.prototype.step=function(){if((128&this.m_mmu.read(this.LCDC))>0){switch(this.m_state){case this.state.Mode0:this.m_clock>=455&&(this.m_mmu.read(this.LY)>=143?(this.m_state=this.state.Mode1,this.m_mmu.write(this.STAT,252&this.m_mmu.read(this.STAT)),this.m_mmu.write(this.STAT,1|this.m_mmu.read(this.STAT)),this.m_mmu.write(this.LY,this.m_mmu.read(this.LY)+1),this.m_mmu.write(this.IF,1|this.m_mmu.read(this.IF)),(16&this.m_mmu.read(this.STAT))>0&&this.m_mmu.write(this.IF,2|this.m_mmu.read(this.IF)),this.m_windowLineCounter=0):(this.m_state=this.state.Mode2,this.m_mmu.write(this.STAT,252&this.m_mmu.read(this.STAT)),this.m_mmu.write(this.STAT,2|this.m_mmu.read(this.STAT)),this.m_mmu.write(this.LY,this.m_mmu.read(this.LY)+1),(32&this.m_mmu.read(this.STAT))>0&&this.m_mmu.write(this.IF,2|this.m_mmu.read(this.IF))),this.m_clock=-1);break;case this.state.Mode1:this.m_clock>=455&&(this.m_mmu.write(this.LY,this.m_mmu.read(this.LY)+1),154==this.m_mmu.read(this.LY)&&(this.m_state=this.state.Mode2,this.m_mmu.write(this.STAT,252&this.m_mmu.read(this.STAT)),this.m_mmu.write(this.STAT,2|this.m_mmu.read(this.STAT)),this.m_mmu.write(this.LY,0),(32&this.m_mmu.read(this.STAT))>0&&this.m_mmu.write(this.IF,2|this.m_mmu.read(this.IF))),this.m_clock=-1);break;case this.state.Mode2:this.m_clock>=79&&(this.m_state=this.state.Mode3,this.m_mmu.write(this.STAT,3|this.m_mmu.read(this.STAT)));break;case this.state.Mode3:this.m_clock>=251&&(this.m_state=this.state.Mode0,this.m_mmu.write(this.STAT,252&this.m_mmu.read(this.STAT)),(128&this.m_mmu.read(this.STAT))>0&&this.m_mmu.write(this.IF,2|this.m_mmu.read(this.IF)),this.renderLine())}this.m_mmu.read(this.LY)==this.m_mmu.read(this.LYC)?0==(4&this.m_mmu.read(this.STAT))&&((64&this.m_mmu.read(this.STAT))>0&&this.m_mmu.write(this.IF,2|this.m_mmu.read(this.IF)),this.m_mmu.write(this.STAT,4|this.m_mmu.read(this.STAT))):this.m_mmu.write(this.STAT,251&this.m_mmu.read(this.STAT)),this.m_clock+=1}},t.prototype.renderLine=function(){(1&this.m_mmu.read(this.LCDC))>0&&this.renderBackgroundLine(),(32&this.m_mmu.read(this.LCDC))>0&&this.renderWindowLine(),(2&this.m_mmu.read(this.LCDC))>0&&this.renderObjectLine()},t.prototype.renderBackgroundLine=function(){for(var t=0;t<160;t++){var s,i=(this.m_mmu.read(this.SCX)+t)%256,e=(this.m_mmu.read(this.SCY)+this.m_mmu.read(this.LY))%256,r=32*Math.floor(e/8)+Math.floor(i/8);s=(16&this.m_mmu.read(this.LCDC))>0?(8&this.m_mmu.read(this.LCDC))>0?this.VRAM_1+16*this.m_mmu.read(this.TILE_MAP2+r):this.VRAM_1+16*this.m_mmu.read(this.TILE_MAP1+r):(8&this.m_mmu.read(this.LCDC))>0?this.VRAM_2+(16*this.m_mmu.read(this.TILE_MAP2+r)<<24>>24):this.VRAM_2+(16*this.m_mmu.read(this.TILE_MAP1+r)<<24>>24);var m=this.m_mmu.read(s+e%8*2),h=128>>i%8,_=0;(this.m_mmu.read(s+e%8*2+1)&h)>0?(m&h)>0?(_=this.colorValues[(192&this.m_mmu.read(this.BGP))>>6],this.m_bgDotVals[t]=3):(_=this.colorValues[(48&this.m_mmu.read(this.BGP))>>4],this.m_bgDotVals[t]=2):(m&h)>0?(_=this.colorValues[(12&this.m_mmu.read(this.BGP))>>2],this.m_bgDotVals[t]=1):(_=this.colorValues[3&this.m_mmu.read(this.BGP)],this.m_bgDotVals[t]=0),this.m_frame[160*this.m_mmu.read(this.LY)+t]=_}},t.prototype.renderWindowLine=function(){if(this.m_mmu.read(this.LY)>=this.m_mmu.read(this.WY)){for(var t=this.m_mmu.read(this.WX)-7;t<160;t++){var s,i=t+7-this.m_mmu.read(this.WX),e=this.m_windowLineCounter,r=32*Math.floor(e/8)+Math.floor(i/8);s=(64&this.m_mmu.read(this.WX))>0?this.VRAM_1+16*this.m_mmu.read(this.TILE_MAP2+r):this.VRAM_1+16*this.m_mmu.read(this.TILE_MAP1+r);var m=this.m_mmu.read(s+e%8*2),h=128>>i%8,_=0;(this.m_mmu.read(s+e%8*2+1)&h)>0?(m&h)>0?(_=this.colorValues[(192&this.m_mmu.read(this.BGP))>>6],this.m_bgDotVals[t]=3):(_=this.colorValues[(48&this.m_mmu.read(this.BGP))>>4],this.m_bgDotVals[t]=2):(m&h)>0?(_=this.colorValues[(12&this.m_mmu.read(this.BGP))>>2],this.m_bgDotVals[t]=1):(_=this.colorValues[3&this.m_mmu.read(this.BGP)],this.m_bgDotVals[t]=0),this.m_frame[160*this.m_mmu.read(this.LY)+t]=_}this.m_mmu.read(this.WX)<=166&&(this.m_windowLineCounter+=1)}},t.prototype.renderObjectLine=function(){for(var t=0,s=0;s<40;s++){var i=this.m_mmu.read(this.OAM+4*s+1)-8,e=this.m_mmu.read(this.OAM+4*s)-this.m_mmu.read(this.LY),r=this.m_mmu.read(this.OAM+4*s+3),m=0;if((4&this.m_mmu.read(this.LCDC))>0){if(e<1||e>16)continue;m=e<9?64&r?this.VRAM_1+16*(254&this.m_mmu.read(this.OAM+4*s+2)):this.VRAM_1+16*(1|this.m_mmu.read(this.OAM+4*s+2)):64&r?this.VRAM_1+16*(1|this.m_mmu.read(this.OAM+4*s+2)):this.VRAM_1+16*(254&this.m_mmu.read(this.OAM+4*s+2))}else{if(e<9||e>16)continue;m=this.VRAM_1+16*this.m_mmu.read(this.OAM+4*s+2)}64&r?e-=1:e=16-e;var h=this.m_mmu.read(m+e%8*2),_=this.m_mmu.read(m+e%8*2+1),u=0;u=(32&r)>0?1:128;for(var n=0;n<8;n++){if(i>=0||i<160){var o,g=0;if(o=16&r?this.OBP1:this.OBP0,_&u)g=h&u?this.colorValues[(192&this.m_mmu.read(o))>>6]:this.colorValues[(48&this.m_mmu.read(o))>>4];else{if(!(h&u)){32&r?u<<=1:u>>=1,i+=1;continue}g=this.colorValues[(12&this.m_mmu.read(o))>>2]}(128&r)>0?0==this.m_bgDotVals[i]&&(this.m_frame[160*this.m_mmu.read(this.LY)+i]=g):this.m_frame[160*this.m_mmu.read(this.LY)+i]=g}(32&r)>0?u<<=1:u>>=1,i+=1}if(10==(t+=1))break}},t}(),e=function(){function t(){}return t.BIOS_DMG=[49,254,255,175,33,255,159,50,203,124,32,251,33,38,255,14,17,62,128,50,226,12,62,243,226,50,62,119,119,62,252,224,71,17,4,1,33,16,128,26,205,149,0,205,150,0,19,123,254,52,32,243,17,216,0,6,8,26,19,34,35,5,32,249,62,25,234,16,153,33,47,153,14,12,61,40,8,50,13,32,249,46,15,24,243,103,62,100,87,224,66,62,145,224,64,4,30,2,14,12,240,68,254,144,32,250,13,32,247,29,32,242,14,19,36,124,30,131,254,98,40,6,30,193,254,100,32,6,123,226,12,62,135,226,240,66,144,224,66,21,32,210,5,32,79,22,32,24,203,79,6,4,197,203,17,23,193,203,17,23,5,32,245,34,35,34,35,201,206,237,102,102,204,13,0,11,3,115,0,131,0,12,0,13,0,8,17,31,136,137,0,14,220,204,110,230,221,221,217,153,187,187,103,99,110,14,236,204,221,220,153,159,187,185,51,62,60,66,185,165,185,165,66,60,33,4,1,17,168,0,26,19,190,32,254,35,125,254,52,32,245,6,25,120,134,35,5,32,251,134,32,254,62,1,224,80],t}(),r=function(){function t(t){var s=this;this.file=t,this.m_BIOS=new Uint8Array(256).fill(0),this.m_addrBus=new Uint8Array(65536).fill(0),this.m_isRomLoaded=!1,this.m_isBIOSMapped=!0,this.m_isGBC=!1;var i=new FileReader;i.onload=function(){return s.loadROM(i.result)},i.readAsArrayBuffer(this.file),this.loadBIOS()}return t.prototype.read=function(t){if(this.m_isGBC,this.m_isBIOSMapped){if(t<=256){if(256!=t)return this.m_BIOS[t];this.m_isBIOSMapped=!1}return this.m_addrBus[t]}return this.m_addrBus[t]},t.prototype.write=function(t,s){t>=32768&&(this.m_addrBus[t]=s)},t.prototype.loadBIOS=function(){for(var t=0;t<e.BIOS_DMG.length;t++)this.m_BIOS[t]=e.BIOS_DMG[t]},t.prototype.loadROM=function(t){for(var s=new Uint8Array(t),i=0;i<s.length;i++)this.m_addrBus[i]=s[i];this.m_isRomLoaded=!0},t}(),m=function(){function t(t){this.m_file=t,this.m_frame=new Array(23040).fill(0),this.m_mmu=new r(t),this.m_cpu=new s(this.m_mmu),this.m_gpu=new i(this.m_mmu,this.m_frame),this.m_inVBLANK=!1,this.m_cpu,this.m_gpu,this.m_inVBLANK}return t.prototype.getFrame=function(){for(;!this.m_mmu.m_isRomLoaded;)return this.m_frame;for(;this.m_mmu.read(65348)>=144&&this.m_inVBLANK;)this.m_cpu.step(),this.m_gpu.step();for(this.m_inVBLANK=!1;this.m_mmu.read(65348)<144&&!this.m_inVBLANK;)this.m_cpu.step(),this.m_gpu.step();return this.m_inVBLANK=!0,this.m_frame},t}(),h=document.getElementById("canvas").getContext("2d"),_=[0,8,16,24,32,41,49,57,65,74,82,90,98,106,115,123,131,139,148,156,164,172,180,189,197,205,213,222,230,238,246,255],u=h.createImageData(160,144),n=0;function o(){for(var s=u.data,i=t.getFrame(),e=0;e<144;e++)for(var r=0;r<1;r++)for(var m=0;m<160;m++)for(var o=0;o<1;o++)s[4*(n=160*e+m)]=_[31&i[n]],s[4*n+1]=_[(992&i[n])>>5],s[4*n+2]=_[(31744&i[n])>>10],s[4*n+3]=255;h.putImageData(u,0,0)}document.getElementById("file-selector").addEventListener("change",(function(s){var i=s.target.files;t=new m(i[0]),setInterval(o,1e3/60)}))})();